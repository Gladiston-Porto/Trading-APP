# Fase 2G - ConfluenceEngine: ESTRUTURA DE ARQUIVOS

## üìÅ √çndice

1. [Arquivos Criados](#arquivos-criados)
2. [Estrutura de Diret√≥rios](#estrutura-diret√≥rios)
3. [Descri√ß√£o Detalhada por Arquivo](#descricao-detalhada)
4. [Depend√™ncias Entre Arquivos](#dependencias)
5. [Integra√ß√µes com Fase Anterior](#integra√ß√µes)

---

## üìÇ Arquivos Criados {#arquivos-criados}

### Novos Arquivos

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ signals.routes.ts          ‚ú® NOVO - 350 linhas
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ confluence/
‚îÇ           ‚îú‚îÄ‚îÄ ConfluenceEngine.ts        ‚ú® NOVO - 800 linhas
‚îÇ           ‚îî‚îÄ‚îÄ __tests__/
‚îÇ               ‚îî‚îÄ‚îÄ ConfluenceEngine.test.ts ‚ú® NOVO - 500 linhas
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ server.ts                          ‚úèÔ∏è MODIFICADO - Adi√ß√£o de import/rota
```

### Arquivos Existentes (Sem Mudan√ßas)

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ indicator/IndicatorService.ts  (usado por signals.routes.ts)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ market/MarketService.ts        (usado por signals.routes.ts)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pattern/PatternService.ts      (usado por signals.routes.ts)
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ auth.middleware.ts         (usado por signals.routes.ts)
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ logger.ts                      (usado por signals.routes.ts)
‚îî‚îÄ‚îÄ tsconfig.json                          (sem mudan√ßas necess√°rias)
```

---

## üóÇÔ∏è Estrutura de Diret√≥rios {#estrutura-diret√≥rios}

### Antes (Fase 2f)

```
backend/src/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.dto.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.ts
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îú‚îÄ‚îÄ auth.routes.ts
‚îÇ       ‚îú‚îÄ‚îÄ indicator.routes.ts
‚îÇ       ‚îú‚îÄ‚îÄ market.routes.ts
‚îÇ       ‚îî‚îÄ‚îÄ pattern.routes.ts              ‚Üê √öltima rota (Fase 2f)
‚îú‚îÄ‚îÄ config/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.ts
‚îÇ   ‚îú‚îÄ‚îÄ indicator/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IndicatorService.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ market/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MarketService.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ   ‚îî‚îÄ‚îÄ pattern/
‚îÇ       ‚îú‚îÄ‚îÄ PatternService.ts
‚îÇ       ‚îî‚îÄ‚îÄ __tests__/
‚îú‚îÄ‚îÄ utils/
‚îî‚îÄ‚îÄ server.ts
```

### Depois (Fase 2g)

```
backend/src/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.dto.ts
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.ts
‚îÇ   ‚îî‚îÄ‚îÄ routes/
‚îÇ       ‚îú‚îÄ‚îÄ auth.routes.ts
‚îÇ       ‚îú‚îÄ‚îÄ indicator.routes.ts
‚îÇ       ‚îú‚îÄ‚îÄ market.routes.ts
‚îÇ       ‚îú‚îÄ‚îÄ pattern.routes.ts
‚îÇ       ‚îî‚îÄ‚îÄ signals.routes.ts              ‚Üê ‚ú® NOVO (Fase 2g)
‚îú‚îÄ‚îÄ config/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.ts
‚îÇ   ‚îú‚îÄ‚îÄ indicator/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IndicatorService.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ market/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MarketService.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ pattern/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PatternService.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ   ‚îî‚îÄ‚îÄ confluence/                        ‚Üê ‚ú® NOVO (Fase 2g)
‚îÇ       ‚îú‚îÄ‚îÄ ConfluenceEngine.ts            ‚Üê ‚ú® NOVO
‚îÇ       ‚îî‚îÄ‚îÄ __tests__/
‚îÇ           ‚îî‚îÄ‚îÄ ConfluenceEngine.test.ts   ‚Üê ‚ú® NOVO
‚îú‚îÄ‚îÄ utils/
‚îî‚îÄ‚îÄ server.ts                              ‚Üê ‚úèÔ∏è MODIFICADO
```

---

## üìã Descri√ß√£o Detalhada por Arquivo {#descricao-detalhada}

### 1. ConfluenceEngine.ts (800 linhas)

**Localiza√ß√£o**: `backend/src/services/confluence/ConfluenceEngine.ts`

**Prop√≥sito**: Motor central de gera√ß√£o de sinais de trading

**Estrutura Interna**:

```typescript
// ===== SECTION 1: INTERFACES & TYPES (Lines 1-150) =====

interface IndicatorValues {
  ema9: number;
  ema21: number;
  ema200: number;
  sma50: number;
  sma200: number;
  rsi14: number;
  macd: { macd: number; signal: number; histogram: number };
  atr14: number;
  obv: number;
  vwap: number;
}

interface DetectedPattern {
  pattern: string;
  confidence: number;
  isUptrend: boolean;
  description: string;
}

interface Candle {
  date: string;
  open: number;
  high: number;
  low: number;
  close: number;
  volume: number;
}

interface SignalConfidence {
  trend: number;
  momentum: number;
  pattern: number;
  volume: number;
  volatility: number;
  weighted: number;
}

interface TradingSignal {
  ticker: string;
  date: string;
  direction: 'BUY' | 'SELL' | 'NEUTRAL';
  confidence: number;
  strength: 'WEAK' | 'MEDIUM' | 'STRONG';
  rationale: {
    trend: string;
    momentum: string;
    pattern: string;
    volume: string;
    summary: string;
  };
  riskReward: {
    stopLoss: number;
    takeProfit: number;
    riskRewardRatio: number;
    distance: { toSL: number; toTP: number };
  };
  confluence: SignalConfidence;
  components: { indicators: string[]; patterns: string[] };
}

// ===== SECTION 2: SCORING METHODS (Lines 151-400) =====

class ConfluenceEngine {
  private static calculateTrendScore(
    indicators: IndicatorValues,
    candles: Candle[]
  ): number {
    // EMA/SMA alignment analysis
    // Price vs EMA200 positioning
    // Returns 0-100
  }

  private static calculateMomentumScore(indicators: IndicatorValues): number {
    // RSI(14) zone analysis
    // MACD histogram and crossover
    // Returns 0-100
  }

  private static calculateVolatilityScore(indicators: IndicatorValues): number {
    // ATR health check
    // OBV confirmation
    // Returns 0-100
  }

  private static calculatePatternScore(patterns: DetectedPattern[]): number {
    // Top pattern confidence extraction
    // Bullish vs bearish weighting
    // Returns 0-100
  }

  private static calculateVolumeScore(
    indicators: IndicatorValues,
    candles: Candle[]
  ): number {
    // Current volume vs average
    // OBV trend confirmation
    // Returns 0-100
  }

  private static weightedConfidence(
    trend: number,
    momentum: number,
    pattern: number,
    volume: number,
    volatility: number
  ): number {
    // Weighted average: 35% + 25% + 20% + 15% + 5%
    // Returns final 0-100 score
  }

  // ===== SECTION 3: DETERMINATION METHODS (Lines 401-500) =====

  private static determineDirection(
    trend: number,
    momentum: number,
    pattern: number,
    patterns: DetectedPattern[]
  ): 'BUY' | 'SELL' | 'NEUTRAL' {
    // Count bullish/bearish signals
    // Majority wins
    // Returns direction
  }

  private static determineStrength(confidence: number): 'WEAK' | 'MEDIUM' | 'STRONG' {
    // >= 75 = STRONG
    // 60-74 = MEDIUM
    // < 60 = WEAK
    // Returns strength
  }

  // ===== SECTION 4: RISK/REWARD CALCULATION (Lines 501-600) =====

  private static calculateRiskReward(
    candle: Candle,
    direction: 'BUY' | 'SELL' | 'NEUTRAL',
    volatility: number,
    atr: number
  ): RiskReward {
    // For BUY: SL below, TP above
    // For SELL: SL above, TP below
    // Calculate RR ratio and distances
    // Returns {SL, TP, RR, distances}
  }

  // ===== SECTION 5: RATIONALE GENERATION (Lines 601-700) =====

  private static generateRationale(
    trendScore: number,
    momentumScore: number,
    patternScore: number,
    volumeScore: number,
    trends: string[],
    isUptrend: boolean
  ): Rationale {
    // Generate explainable AI rationale
    // Justify each component decision
    // Returns readable explanation
  }

  // ===== SECTION 6: PUBLIC METHODS (Lines 701-800) =====

  static generateSignal(
    ticker: string,
    candles: Candle[],
    indicators: IndicatorValues,
    patterns: DetectedPattern[]
  ): TradingSignal {
    // Main orchestration method
    // Combines all above methods
    // Returns complete TradingSignal
  }

  static scanMultiple(results: Map<string, TradingSignal>): Map<string, TradingSignal> {
    // Process batch of signals
    // Returns signals map
  }

  static filterByStrength(
    signals: TradingSignal[],
    minStrength: 'WEAK' | 'MEDIUM' | 'STRONG'
  ): TradingSignal[] {
    // Filter signals by strength
    // Returns filtered array
  }

  static filterByDirection(
    signals: TradingSignal[],
    direction: 'BUY' | 'SELL'
  ): TradingSignal[] {
    // Filter signals by direction
    // Returns filtered array
  }

  static calculateStats(signals: TradingSignal[]): SignalStats {
    // Calculate statistics
    // Returns aggregated stats
  }

  private static identifyComponents(
    indicators: IndicatorValues,
    patterns: DetectedPattern[]
  ): { indicators: string[]; patterns: string[] } {
    // Identify which components were used
    // Returns component list
  }
}

export default ConfluenceEngine;
export { TradingSignal, IndicatorValues, SignalConfidence };
```

**Linhas de C√≥digo**:
- 1-50: Copyright + imports
- 51-150: Type/interface definitions
- 151-250: calculateTrendScore() + helpers
- 251-350: calculateMomentumScore() + helpers
- 351-400: calculateVolatilityScore(), calculatePatternScore(), calculateVolumeScore()
- 401-450: weightedConfidence(), determineDirection(), determineStrength()
- 451-550: calculateRiskReward()
- 551-650: generateRationale() e rationale helpers
- 651-700: identifyComponents(), helper methods
- 701-800: generateSignal(), scanMultiple(), filterByStrength(), filterByDirection(), calculateStats()

---

### 2. ConfluenceEngine.test.ts (500 linhas)

**Localiza√ß√£o**: `backend/src/services/confluence/__tests__/ConfluenceEngine.test.ts`

**Prop√≥sito**: Testes unit√°rios e integra√ß√£o do ConfluenceEngine

**Estrutura**:

```typescript
// ===== HELPERS (Lines 1-100) =====

function createCandle(
  date: string,
  open: number,
  high: number,
  low: number,
  close: number,
  volume: number
): Candle { ... }

function createBullishIndicators(): IndicatorValues { ... }
function createBearishIndicators(): IndicatorValues { ... }
function createHistoricalCandles(): Candle[] { ... }
function createBullishPattern(): DetectedPattern { ... }
function createBearishPattern(): DetectedPattern { ... }

// ===== TEST SUITES (Lines 101-500) =====

describe('ConfluenceEngine', () => {
  
  describe('calculateTrendScore', () => {
    it('should calculate bullish trend (score > 55)', ...)
    it('should calculate bearish trend (score < 45)', ...)
    it('should handle neutral trend (45-55)', ...)
  })

  describe('calculateMomentumScore', () => {
    it('should detect bullish momentum (RSI > 50)', ...)
    it('should detect bearish momentum (RSI < 50)', ...)
    it('should detect oversold (RSI < 30)', ...)
    it('should detect overbought (RSI > 70)', ...)
  })

  describe('calculatePatternScore', () => {
    it('should boost score with bullish pattern', ...)
    it('should reduce score with bearish pattern', ...)
    it('should handle empty patterns', ...)
  })

  describe('determineDirection', () => {
    it('should generate BUY signal', ...)
    it('should generate SELL signal', ...)
    it('should generate NEUTRAL signal', ...)
  })

  describe('determineStrength', () => {
    it('should identify STRONG (>=75)', ...)
    it('should identify MEDIUM (60-75)', ...)
    it('should identify WEAK (<60)', ...)
  })

  describe('calculateRiskReward', () => {
    it('should set SL below entry for BUY', ...)
    it('should set TP above entry for BUY', ...)
    it('should calculate valid RR ratio', ...)
  })

  describe('generateRationale', () => {
    it('should generate comprehensive rationale', ...)
    it('should include bullish language in bullish signal', ...)
  })

  describe('identifyComponents', () => {
    it('should identify used indicators', ...)
    it('should identify detected patterns', ...)
  })

  describe('Signal Structure', () => {
    it('should have valid signal structure', ...)
  })

  describe('scanMultiple', () => {
    it('should generate signals for multiple tickers', ...)
  })

  describe('filterByStrength', () => {
    it('should filter STRONG signals only', ...)
  })

  describe('filterByDirection', () => {
    it('should filter by direction (BUY/SELL)', ...)
  })

  describe('calculateStats', () => {
    it('should calculate signal statistics', ...)
  })

  describe('Edge Cases', () => {
    it('should handle missing indicators', ...)
    it('should handle empty candles array', ...)
    it('should handle empty patterns array', ...)
  })

  describe('Integration', () => {
    it('should generate complete trading signal', ...)
    it('should handle live trading workflow', ...)
  })
})
```

**Linha Layout**:
- 1-30: Imports e setup
- 31-100: Helper functions (createCandle, createIndicators, etc)
- 101-150: calculateTrendScore suite (3 tests)
- 151-200: calculateMomentumScore suite (4 tests)
- 201-250: calculatePatternScore suite (3 tests)
- 251-300: determineDirection suite (3 tests)
- 301-350: determineStrength suite (3 tests)
- 351-400: calculateRiskReward suite (3 tests)
- 401-430: generateRationale suite (2 tests)
- 431-460: identifyComponents suite (2 tests)
- 461-480: Signal structure test (1 test)
- 481-500: Batch operations + integration (9+ tests)

**Coverage**: 90%+

---

### 3. signals.routes.ts (350 linhas)

**Localiza√ß√£o**: `backend/src/api/routes/signals.routes.ts`

**Prop√≥sito**: REST API endpoints para gera√ß√£o de sinais

**Estrutura**:

```typescript
// ===== IMPORTS (Lines 1-12) =====
import { Router, Request, Response } from 'express';
import { authMiddleware } from '../middleware/auth.middleware';
import ConfluenceEngine, { TradingSignal, IndicatorValues } from '../../services/confluence/ConfluenceEngine';
import IndicatorService from '../../services/indicator/IndicatorService';
import PatternService from '../../services/pattern/PatternService';
import MarketService from '../../services/market/MarketService';
import logger from '../../utils/logger';

// ===== ROUTER SETUP (Lines 13-20) =====
const router = Router();
router.use(authMiddleware);

// ===== TYPE ADAPTER (Lines 22-38) =====
function adaptIndicatorsToConfluence(
  indicatorResults: any,
  candles: any[]
): IndicatorValues {
  // Convert IndicatorService output arrays ‚Üí ConfluenceEngine scalars
  // Extract last values from IndicatorValue[] arrays
}

// ===== ENDPOINT 1: POST /api/signals/generate/:ticker (Lines 40-150) =====
router.post('/generate/:ticker', async (req: Request, res: Response) => {
  // Validate inputs
  // Fetch candles
  // Calculate indicators
  // Adapt types
  // Detect patterns
  // Generate signal
  // Filter by confidence
  // Return response
})

// ===== ENDPOINT 2: POST /api/signals/scan-all (Lines 151-260) =====
router.post('/scan-all', async (req: Request, res: Response) => {
  // Validate inputs (array, max 50, confidence 0-100)
  // Process each ticker in parallel (Promise.all)
  // Handle errors individually
  // Filter by confidence & strength
  // Sort by confidence
  // Calculate stats
  // Return aggregated response
})

// ===== ENDPOINT 3: POST /api/signals/history (Lines 261-330) =====
router.post('/history', async (req: Request, res: Response) => {
  // Validate dates
  // Check 1-365 day range
  // Fetch historical data
  // Calculate indicators
  // Generate signals (simulated, DB in production)
  // Filter by strength
  // Return historical signals + summary
})

// ===== ENDPOINT 4: GET /api/signals/info (Lines 331-350) =====
router.get('/info', (_req: Request, res: Response) => {
  // Return engine metadata
  // Scoring weights
  // Available endpoints
})

// ===== EXPORT (Line 350) =====
export default router;
```

**Linha Details**:
- 1-12: Imports (express, middleware, services, logger)
- 13-20: Router initialization + auth middleware
- 22-38: Type adapter function (IndicatorValue[] ‚Üí IndicatorValues)
- 40-110: Validation + logging
- 111-150: Single signal generation logic
- 151-180: Input validation for batch
- 181-230: Parallel processing loop
- 231-260: Stats calculation + response
- 261-310: History endpoint logic
- 311-330: Response formatting
- 331-348: Info endpoint
- 349-350: Export

**Endpoints Summary**:

| Endpoint | Method | Auth | Purpose |
|----------|--------|------|---------|
| `/generate/:ticker` | POST | ‚úÖ | Single signal |
| `/scan-all` | POST | ‚úÖ | Batch (50 max) |
| `/history` | POST | ‚úÖ | Historical signals |
| `/info` | GET | ‚ùå | Engine metadata |

---

### 4. server.ts (MODIFICADO)

**Localiza√ß√£o**: `backend/src/server.ts`

**Mudan√ßas Realizadas**:

```diff
  // Lines 1-11 (imports section)
  import authRouter from "./api/routes/auth.routes";
  import marketRouter from "./api/routes/market.routes";
  import indicatorRouter from "./api/routes/indicator.routes";
  import patternRouter from "./api/routes/pattern.routes";
+ import signalsRouter from "./api/routes/signals.routes";  // ‚ú® NOVO

  // Lines 40-48 (routes section)
  app.use("/api/auth", authRouter);
  app.use("/api/market", marketRouter);
  app.use("/api/indicators", indicatorRouter);
  app.use("/api/patterns", patternRouter);
+ app.use("/api/signals", signalsRouter);  // ‚ú® NOVO - Sinais de Trading
```

**Linhas Modificadas**:
- Linha 12: Adicionar import de signalsRouter
- Linhas 45-46: Registrar rota em `/api/signals`

---

## üîó Depend√™ncias Entre Arquivos {#dependencias}

```
signals.routes.ts
‚îú‚îÄ Imports ConfluenceEngine.ts
‚îÇ  ‚îú‚îÄ Usa: generateSignal()
‚îÇ  ‚îú‚îÄ Usa: scanMultiple()
‚îÇ  ‚îú‚îÄ Usa: filterByStrength()
‚îÇ  ‚îú‚îÄ Usa: filterByDirection()
‚îÇ  ‚îî‚îÄ Usa: calculateStats()
‚îÇ
‚îú‚îÄ Imports IndicatorService.ts
‚îÇ  ‚îî‚îÄ Usa: calculateAll(candles)
‚îÇ
‚îú‚îÄ Imports PatternService.ts
‚îÇ  ‚îî‚îÄ Usa: detectAllPatterns(candles)
‚îÇ
‚îú‚îÄ Imports MarketService.ts
‚îÇ  ‚îî‚îÄ Usa: getHistoricalDaily(ticker, days)
‚îÇ
‚îî‚îÄ Imports authMiddleware
   ‚îî‚îÄ JWT validation + user context

server.ts
‚îî‚îÄ Imports signals.routes.ts
   ‚îî‚îÄ Registers at /api/signals

ConfluenceEngine.test.ts
‚îú‚îÄ Imports ConfluenceEngine.ts
‚îÇ  ‚îî‚îÄ Tests all public methods
‚îÇ
‚îî‚îÄ Helper functions
   ‚îú‚îÄ createCandle()
   ‚îú‚îÄ createBullishIndicators()
   ‚îú‚îÄ createBullishPattern()
   ‚îî‚îÄ etc.
```

---

## üìö Integra√ß√µes com Fase Anterior {#integra√ß√µes}

### De Fase 2d (MarketService)

```typescript
// MarketService.ts (usado em signals.routes.ts)
export interface Candle {
  date: string;
  open: number;
  high: number;
  low: number;
  close: number;
  volume: number;
  adjusted_close?: number;
}

// signals.routes.ts
const candles = await MarketService.getHistoricalDaily(ticker, days);
```

### De Fase 2e (IndicatorService)

```typescript
// IndicatorService.ts (usado em signals.routes.ts)
export interface IndicatorValue {
  date: string;
  value: number | null;
}

export interface EMASeries {
  ema9: IndicatorValue[];
  ema21: IndicatorValue[];
  ema200: IndicatorValue[];
}

// (similar for SMA, RSI, MACD, ATR, OBV, VWAP)

// signals.routes.ts (adapt step)
function adaptIndicatorsToConfluence(indicatorResults: any, candles: any[]): IndicatorValues {
  const lastIndex = candles.length - 1;
  return {
    ema9: indicatorResults.ema.ema9[lastIndex]?.value || 0,
    // ... etc
  };
}
```

### De Fase 2f (PatternService)

```typescript
// PatternService.ts (usado em signals.routes.ts)
export interface DetectedPattern {
  pattern: string;
  confidence: number;
  isUptrend: boolean;
  description: string;
}

// signals.routes.ts
const patterns = PatternService.detectAllPatterns(candles);
```

### De Fase 2c (Auth Middleware)

```typescript
// auth.middleware.ts (usado em signals.routes.ts)
// Todas as rotas de sinal requerem JWT

router.use(authMiddleware);  // Applied to all endpoints
```

---

## üìä Tamanho e Complexidade

| Arquivo | Linhas | Fun√ß√µes | Classes | Complexidade |
|---------|--------|---------|---------|--------------|
| ConfluenceEngine.ts | 800 | 15+ | 1 | Alta |
| ConfluenceEngine.test.ts | 500 | 35+ | 0 | Alta |
| signals.routes.ts | 350 | 5 | 0 | M√©dia-Alta |
| **Total** | **1650** | **55+** | **1** | **Alta** |

---

## üîç Detalhes T√©cnicos

### TypeScript Configuration

```json
// tsconfig.json (sem mudan√ßas necess√°rias)
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "**/*.test.ts"]
}
```

### Package.json Dependencies

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "@prisma/client": "^5.0.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/express": "^4.17.17",
    "typescript": "^5.0.0",
    "jest": "^29.0.0",
    "@types/jest": "^29.0.0",
    "ts-jest": "^29.0.0"
  }
}
```

---

## üìã Checklist de Integra√ß√£o

- [x] ConfluenceEngine.ts criado em `/backend/src/services/confluence/`
- [x] ConfluenceEngine.test.ts criado em `/backend/src/services/confluence/__tests__/`
- [x] signals.routes.ts criado em `/backend/src/api/routes/`
- [x] Type adapter implementado em signals.routes.ts
- [x] server.ts atualizado com import
- [x] server.ts registra rota em `/api/signals`
- [x] Sem erros de compila√ß√£o TypeScript
- [x] Todas as depend√™ncias importadas
- [x] Autentica√ß√£o middleware aplicado

---

## üöÄ Pronto para

‚úÖ `npm install` (resolvar√° tipos pendentes)  
‚úÖ `npm test` (executar√° ConfluenceEngine.test.ts)  
‚úÖ `npm start` (servidor com /api/signals dispon√≠vel)  
‚úÖ Integra√ß√£o frontend (Fase 3)  

---

*Documenta√ß√£o de Arquivos - Fase 2G*  
*Gerada em: 14 de Janeiro de 2025*
